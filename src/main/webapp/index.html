<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css" />
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script>
        $(function () {
            var data=  [
                {
                    "id": "bogon",
                    "type": "server",
                    "update_at": "2017-05-27 14:00:38.778853",
                    "property": "{\"bogon\": {\"biosversion\": \"6.00\", \"kernel\": \"Linux\", \"domain\": \"\", \"biosreleasedate\": \"06/22/2012\", \"zmqversion\": \"3.2.5\", \"kernelrelease\": \"3.10.0-327.el7.x86_64\", \"selinux\": {\"enforced\": \"Permissive\", \"enabled\": true}, \"serialnumber\": \"VMware-56 4d 5f 18 2b 77 cc 85-1c 79 3e 4b 33 21 d4 22\", \"ip_interfaces\": {\"lo\": [\"127.0.0.1\", \"::1\"], \"ens32\": [\"192.168.0.168\", \"fe80::20c:29ff:fe21:d422\"], \"virbr0-nic\": [], \"virbr0\": [\"192.168.122.1\"]}, \"dddddqaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaawww\": [\"111ddd111\", \"111ddddddd111\", \"111dddddddd111\", \"111dddddddd111d\", \"111dddddddd111dd\", \"111dddddddd111ddd\", \"111ddddddddd111\", \"111dddddddddddddddd111\", \"111ddddddddddddddd111\", \"111ddddddddedd111\", \"===============================1\", \"===================d============1\", \"=================d==d============1\", \"=============d====d==d============1\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<ddddddddedd111\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<<<<<<ddddddddedd111\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<<<<<<ddddddddedd11d1\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<<<<<<ddddddddedd11d1d\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<<<<<ddddddddedd11d1d\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<<<<<ddddddddeddd11d1d\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<<<<<ddddddddeddd11d1dd\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<<<<<ddddddddeddd11dd1dd\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<<<<<ddddddddeddd11dd1d\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<<<<<dddddddddeddd11dd1d\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<<<<<dddd\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<d<<<<dddd\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<dd<<<<dddd\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<dd<<<d<dddd\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<ddd<<<d<dddd\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<dd<<<d<ddddd\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<dd<<<d<dddddd\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<dd<<<d<ddddddd\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<dd<<<d<dddddddddddddddd\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<dd<<<d<ddddddddddddddddd\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<dd<<<d<dddddddddddddddddd\", \"111<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<NNNNNNNNNNNNNN<<dddddd<dd<<<d<dddddddddddddddddddddddddd\", \"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\", \"*\"], \"mem_total\": 3791, \"saltversioninfo\": [2015, 5, 10, 0], \"host\": \"bogon\", \"SSDs\": [], \"mdadm\": [], \"id\": \"bogon\", \"osrelease\": \"7.2\", \"ps\": \"ps -efH\", \"systemd\": {\"version\": \"219\", \"features\": \"+PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ -LZ4 -SECCOMP +BLKID +ELFUTILS +KMOD +IDN\"}, \"ip6_interfaces\": {\"lo\": [\"::1\"], \"ens32\": [\"fe80::20c:29ff:fe21:d422\"], \"virbr0-nic\": [], \"virbr0\": []}, \"num_cpus\": 4, \"hwaddr_interfaces\": {\"lo\": \"00:00:00:00:00:00\", \"ens32\": \"00:0c:29:21:d4:22\", \"virbr0-nic\": \"52:54:00:79:fd:d1\", \"virbr0\": \"52:54:00:79:fd:d1\"}, \"osfullname\": \"Red Hat Enterprise Linux Server\", \"ip4_interfaces\": {\"lo\": [\"127.0.0.1\"], \"ens32\": [\"192.168.0.168\"], \"virbr0-nic\": [], \"virbr0\": [\"192.168.122.1\"]}, \"init\": \"systemd\", \"master\": \"192.168.0.168\", \"ipv4\": [\"127.0.0.1\", \"192.168.0.168\", \"192.168.122.1\"], \"ipv6\": [\"::1\", \"fe80::20c:29ff:fe21:d422\"], \"cpu_flags\": [\"fpu\", \"vme\", \"de\", \"pse\", \"tsc\", \"msr\", \"pae\", \"mce\", \"cx8\", \"apic\", \"sep\", \"mtrr\", \"pge\", \"mca\", \"cmov\", \"pat\", \"pse36\", \"clflush\", \"dts\", \"mmx\", \"fxsr\", \"sse\", \"sse2\", \"ss\", \"ht\", \"syscall\", \"nx\", \"rdtscp\", \"lm\", \"constant_tsc\", \"arch_perfmon\", \"pebs\", \"bts\", \"nopl\", \"xtopology\", \"tsc_reliable\", \"nonstop_tsc\", \"aperfmperf\", \"eagerfpu\", \"pni\", \"pclmulqdq\", \"ssse3\", \"cx16\", \"sse4_1\", \"sse4_2\", \"popcnt\", \"aes\", \"xsave\", \"avx\", \"hypervisor\", \"lahf_lm\", \"ida\", \"arat\", \"epb\", \"pln\", \"pts\", \"dtherm\", \"xsaveopt\"], \"localhost\": \"bogon\", \"lsb_distrib_id\": \"Red Hat Enterprise Linux Server\", \"fqdn_ip4\": [\"192.168.122.1\", \"192.168.0.168\"], \"pythonversion\": [2, 7, 5, \"final\", 0], \"shell\": \"/bin/sh\", \"nodename\": \"bogon\", \"saltversion\": \"2015.5.10\", \"pythonpath\": [\"/usr/bin\", \"/usr/lib64/python27.zip\", \"/usr/lib64/python2.7\", \"/usr/lib64/python2.7/plat-linux2\", \"/usr/lib64/python2.7/lib-tk\", \"/usr/lib64/python2.7/lib-old\", \"/usr/lib64/python2.7/lib-dynload\", \"/usr/lib64/python2.7/site-packages\", \"/usr/lib64/python2.7/site-packages/gst-0.10\", \"/usr/lib64/python2.7/site-packages/gtk-2.0\", \"/usr/lib/python2.7/site-packages\"], \"server_id\": 639865338, \"saltpath\": \"/usr/lib/python2.7/site-packages/salt\", \"osmajorrelease\": \"7\", \"os_family\": \"RedHat\", \"oscodename\": \"Maipo\", \"osfinger\": \"Red Hat Enterprise Linux Server-7\", \"ttt\": [\"ttt\", \"tttd\"], \"manufacturer\": \"VMware, Inc.\", \"num_gpus\": 1, \"virtual\": \"VMware\", \"cpu_model\": \"Intel(R) Core(TM) i7-3770 CPU @ 3.40GHz\", \"fqdn\": \"bogon\", \"pythonexecutable\": \"/usr/bin/python\", \"productname\": \"VMware Virtual Platform\", \"osarch\": \"x86_64\", \"cpuarch\": \"x86_64\", \"osrelease_info\": [7, 2], \"locale_info\": {\"detectedencoding\": \"UTF-8\", \"defaultlanguage\": \"en_US\", \"defaultencoding\": \"UTF-8\"}, \"gpus\": [{\"model\": \"SVGA II Adapter\", \"vendor\": \"unknown\"}], \"hhhhhhhhhhhhhhhhhhhhhhhhhhh\": [], \"path\": \"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin\", \"machine_id\": \"81fdd4dc2fd64ff88fe160624bcba0ab\", \"os\": \"RedHat\", \"fqdn_ip6\": [\"fe80::20c:29ff:fe21:d422\"]}}"
                }
            ];

            // 1.把属性的json字符串值转换成对象，不递归
            var newData = $.map(data, function (item, index) {
                var newItem = {};
                $.each(item, function (key, value) {
                    // 默认不转换返回原值
                    newItem[key] = value;
                    if ($.type(value) == 'string') {
                        // value可能是json字符串
                        // 尝试用JSON.parse解析该字符串，成功就说明是json字符串，返回转换后的对象
                        try {
                            var parse2Obj = JSON.parse(value);
                            newItem[key] = parse2Obj;
                        } catch (e) {

                        }
                    }
                });
                return newItem;
            });

            var $tableBody = $("#table tbody");

            //2.针对性的对property.bogon的数据按情况处理并展示在界面上。
            $.each(newData, function (index, item) {
                $.each(item.property.bogon, function (key, value) {
                    console.log(key);
                    console.log(value);
                    appendTR($tableBody, key, value);
                })
            });

            function appendTR($table, dataKey, dataValue) {
                var $tr = $("<tr></tr>");
                $tr.append('<td>'+dataKey+'</td>');
                $tr.append(createTd2(dataKey, dataValue));
                $table.append($tr)
            }

            function createTd2(dataKey, dataValue) {
                //
                var $td = $("<td></td>");
                var $tdContent = null;
                var type = $.type(dataValue);
                if(type == 'object'){
                    // 未处理
                }else if(type == 'array'){
                    if(isSelect(dataKey, dataValue)){
                        $tdContent = createSelect(dataKey, dataValue)
                    }else{
                        // 未处理
                    }
                }else{
                    // 基本类型
                    $tdContent = $('<input name="'+dataKey+'" value="'+dataValue+'">');
                    $tdContent.addClass("form-control");
                }
                $td.append($tdContent);
                return $td;
            }

            function isSelect(dataKey, dataValue) {
                var isSelect = true;
                if ($.type(dataValue) == 'array' && dataValue.length > 0) {
                    $.each(dataValue, function (index, value) {
                        var valueType = $.type(value);
                        if (valueType == 'object' || valueType == 'array') {
                            isSelect = false;
                            return false; // 跳出循环
                        }
                    });
                } else {
                    isSelect = false;
                }
                return isSelect;
            }

            function createSelect(dataKey, dataValue) {
                var $select = $("<select></select>");
                $select.attr("name", dataKey);
                $select.addClass("form-control");
                $.each(dataValue, function (index, value) {
                    var $option = $("<option value='" + value + "' >" + value + "</option>");
                    $select.append($option)
                });
                return $select;
            }


        });

    </script>
</head>
<body>
    <table id="table" class="table">
        <tbody>
        </tbody>
    </table>
</body>
</html>